---
import { constructUrl, getLangFromUrl } from "@/lib/utils/i18nUtils";
import { plainify } from "@/lib/utils/textConverter";
import ImageMod from "./ImageMod.astro";
import Social from "./Social.astro";
import config from "@/config/config.json";
const { default_language, default_language_in_path } = config.settings;
const { trailing_slash } = config.site;

const { data } = Astro.props;
const { title, image, social } = data.data;
const lang = getLangFromUrl(Astro.url);

const constructLocalizedUrl = (url: string) => {
  if (lang === default_language) {
    return constructUrl(
      default_language_in_path ? `/${lang}${url}` : url,
      lang,
      default_language,
      trailing_slash,
    );
  } else {
    return constructUrl(url, lang, default_language, trailing_slash);
  }
};
---

<div
  class="rounded bg-theme-light p-8 text-center dark:bg-darkmode-theme-light"
>
  {
    image && (
      <ImageMod
        class="mx-auto mb-6 rounded"
        src={image}
        alt={title}
        width={120}
        height={120}
        format="webp"
      />
    )
  }
  <h4 class="mb-3">
    <a href={constructLocalizedUrl(`/${data.slug}`)}>{title}</a>
  </h4>
  <p class="mb-4">
    {plainify(data.body?.slice(0, 100))}
  </p>
  <Social source={social} className="social-icons" />
</div>
